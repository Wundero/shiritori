name: "Build"
description: "Builds the Backend of shiritori"
runs:
    using: composite
    steps:
        # Poetry cache depends on OS, Python version and Poetry version.
        -   name: Cache Poetry cache
            uses: actions/cache@v3
            with:
                path: ~/.cache/pypoetry
                key: poetry-cache-${{ runner.os }}-${{ env.PYTHON_VERSION }}-${{ env.POETRY_VERSION }}

        -   name: Cache Packages
            uses: actions/cache@v3
            with:
                path: ~/.local
                key: poetry-${{ runner.os }}-${{ env.PYTHON_VERSION }}-${{ hashFiles('**/poetry.lock') }}-${{ hashFiles('.github/workflows/*.yml') }}

        -   name: Install poetry
            uses: abatilo/actions-poetry@v2
            with:
                poetry-version: ${{ env.POETRY_VERSION }}

        -   name: Set up Python
            uses: actions/setup-python@v4
            with:
                python-version: ${{ env.PYTHON_VERSION }}
                cache: "poetry"
                cache-dependency-path: "backend/pyproject.toml"
        -   name: Install dependencies
            shell: bash
            run: |
                python -m pip install --upgrade pip poetry ruff
                cd backend
                poetry install
